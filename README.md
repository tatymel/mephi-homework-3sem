Домашние задачи для курса МИФИ "Архитектура компьютера и операционных систем".

## Настройка окружения

**Linux**

Для локального тестирования задач потребуется gcc компилятор и makefile тулза.

Мы рекомендуем использовать Ubuntu версии **20.04**. Дополнительных действий по настройке в таком случае не должно требоваться.

**Windows**

Для локального тестирования достаточно собрать проект, состоящий из всех файлов в папке, и запустить скомпилированный main. В этом может помочь IDE CLion или VSCode.

Однако в тестирующей системе тесты запускаются иначе. Используется ОС Linux, gcc компилятор и makefile тулза. Если есть желание воспроизвести запуск как в тестирующей системе, можно воспользоваться [WSL](https://www.jetbrains.com/help/clion/how-to-use-wsl-development-environment-in-clion.html). Гайд для установки WSL: https://gitlab.manytask.org/mephi-dap-programming-1/public-2022/-/blob/main/docs/wsl.pdf

## Клонируем репозиторий

```bash
# Переходим в директорию, где вы хотите разместить репозиторий с задачами.
# Например, `/home/<username>/mephi/os` для Linux или `/Users/<username>/mephi/os` для MacOS.
$ cd <выбранная директория>

# Клонируем свой репозиторий, который создается автоматически при регистрации на manytask.
# Имя репозитория доступно по ссылке "MY REPO" на mephi-dap-os.manytask.org.
$ git clone https://gitlab.manytask.org/mephi-dap-os/students-2023-2024/<ваш login с mephi-dap-os.manytask.org>.git

# Переходим в директорию склонированного репозитория.
$ cd <ваш репозиторий>

# Настраиваем свое имя в git.
$ git config --local user.name "<ваш login с mephi-dap-os.manytask.org>"
$ git config --local user.email "<ваш email с mephi-dap-os.manytask.org>"

# По дефолту просим git запускать команду rebase для подтягивания конфликтующих изменений.
$ git config --local pull.rebase true

# Настраиваем возможность получать обновления при появлении новых задач.
$ git remote add upstream https://gitlab.manytask.org/mephi-dap-os/public-2023-2024.git
```

## Подтягиваем новые задачи

Периодически необходимо подтягивать изменения из основного репозитория с задачками: https://gitlab.manytask.org/mephi-dap-os/public-2023-2024. Например, когда появляются новые задачки или меняются условия старых.

```bash
$ git pull upstream main
```

Если старые задачи менялись, при подтягивании изменений возможен конфликт ваших локальных изменений и новых изменений от преподавателей. Для разрешения конфликта предлагается:
```bash
# Показать файлы с конфликтами.
$ git status

$ ... разрешение конфликта в каждом из файлов ...

# Сообщаем git для каждого файла, что конфликт разрешен.
$ git add <файл с конфликтом>

# Продолжаем подтягивание изменений.
# После выполнения команды последующие изменения могут опять создать конфликт и процедуру разрешения конфликта придется повторить.
$ git rebase --continue
```

Когда убедились, что изменения корректно применились, пушим их в репозиторий:
```bash
$ git push -f
```

Если послать решение задачи вместе с изменениями от rebase, то тестирующая система не сможет определить список решенных задач, потому что rebase полностью переписывает историю. В такой ситуации предлагается поменять свое решение любым образом (например, добавив лишнюю пустую строку) и послать решение еще раз.

## Решаем задачи

В каждой из папок находится условие и файлы очередной задачи.

Файлы main.cpp и makefile в каждой задаче отвечают за тестирование. При проверке решения они перезаписываются, так что их изменения не учитываются.

Остальные файлы менять можно и нужно.

Для тестирования в каждой задаче достаточно вызвать:
```bash
$ make
```

Команда соберет бинарные файлы из исходных и запустит тесты в main.cpp.

Как только убедились, что решение работает, отправить его можно коммитом в репозиторний:
```bash
$ git add <измененный файл>
$ git commit -m "<комментарий, описывающий изменения>"
$ git push origin main
```

Процесс проверки автоматизирован, результаты проверки можно увидеть либо в CI/CD коммита (зеленая/красная/желтая галочка напротив коммита), либо во вкладках SUBMITS и GDOC главной страницы курса https://mephi-dap-os.manytask.org/.

Закрытых тестов в задачах нет, все тесты публичные и доступны в main.cpp. Сообщения, записанные в консоль в процессе тестирования, можно увидеть в результатах проверки.

## Запуск в докере

Если у вас нет linux или x86_64 процессора, то вы можете воспользоваться докером.

1) [Скачать](https://www.docker.com/products/docker-desktop/) приложение докера.

2) Создаем образ `mephi-os` (требуется сделать всего один раз):
```bash
cd <ваш репозиторий>
docker build --platform linux/x86_64 . -t mephi-os
```

3) После того как вы создали образ `mephi-os`. Можно создать контейнер:
```bash
cd <ваш репозиторий>
docker run --platform linux/x86_64 -it -v ./:/workspace mephi-os bash
```

Эта команда переключает вас в контейнер в интерактивном режиме, а так же синхронизирует вашу текущую директорию с директорией `/workspace` в контейнере. Вы можете менять файлы как в контейнере, так и вне, все изменения будут видны в обоих местах. 
В контейнере можно запускать код с помощью команды make, а так же тестировать с помощью gdb.

## Запуск gdb на не x86_64 архитектурах

1) Запуститься докере

2) Запустить бинарник `main` в эмуляторе qemu в фоновом режиме
```bash
qemu-x86_64-static -g 1234 main &
```

3) Подключится в gdb
```bash
gdb main
...
(gdb) target remote localhost:1234
```

Ваш бинарник уже запущен, можно начинать дебажить.

## Codestyle
Для того, чтобы пройти ревью, нужно, чтобы код соответсвовал следующему кодстайлу: https://ysda.gitlab.io/algorithms/styleguide.html
